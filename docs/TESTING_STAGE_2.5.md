# 🧪 Инструкция по тестированию ЭТАПА 2.5

**URL для тестирования:** http://localhost:5173/admin/newsletters/create

---

## ✅ Что нужно проверить:

### 1. **Кнопка переменных в toolbar** 🎯

**Где:** В панели форматирования над полем "Текст рассылки"

**Что проверить:**
- [ ] Кнопка "{{}} Переменная" находится в начале toolbar
- [ ] При клике открывается dropdown
- [ ] В dropdown есть поиск
- [ ] Есть вкладки: Все / 👤 Пользователь / ⚙️ Система
- [ ] Список переменных отображается с описаниями

---

### 2. **Вставка переменной** ✏️

**Шаги:**
1. Переключитесь на "📝 Простой редактор" (если не активен)
2. В поле "Текст рассылки" напишите: `Привет, `
3. Нажмите кнопку "{{}} Переменная"
4. Выберите переменную `{{name}}`

**Ожидаемый результат:**
- [ ] Текст стал: `Привет, {{name}}`
- [ ] Курсор находится после `{{name}}`
- [ ] Можно сразу продолжать печатать

---

### 3. **Блок "Используемые переменные"** 📋

**Где:** Под полем "Текст рассылки"

**Что проверить:**
- [ ] Блок появился с синим фоном
- [ ] Заголовок: "ℹ️ Используемые переменные:"
- [ ] Показана карточка с `{{name}}`
- [ ] В карточке есть описание: "Полное имя пользователя"
- [ ] При наведении на карточку есть hover-эффект (поднимается вверх)

---

### 4. **Превью с заменой переменных** 👁️

**Где:** Правая панель "👁️ Предварительный просмотр"

**Что проверить:**
- [ ] В заголовке превью есть подсказка: "💡 Переменные заменены на примеры"
- [ ] В теле письма текст: `Привет, Иван Иванов`
- [ ] Переменная заменена на пример из базы

---

### 5. **Множественные переменные** 🔢

**Шаги:**
1. Очистите поле "Текст рассылки"
2. Введите текст:
   ```
   Привет, {{name}}!
   
   Ваш email: {{email}}
   Баланс: {{balance}} монет
   ```

**Ожидаемый результат:**
- [ ] В блоке "Используемые переменные" показаны 3 карточки
- [ ] В превью текст:
   ```
   Привет, Иван Иванов!
   
   Ваш email: user@example.com
   Баланс: 100 монет
   ```

---

### 6. **Поиск переменных** 🔍

**Шаги:**
1. Нажмите кнопку "{{}} Переменная"
2. В поле поиска введите: `email`

**Ожидаемый результат:**
- [ ] Показаны только переменные с "email" в названии/описании
- [ ] Минимум 2 результата: `email` и `supportEmail`

---

### 7. **Категории переменных** 📂

**Шаги:**
1. Нажмите кнопку "{{}} Переменная"
2. Переключайтесь между вкладками:
   - Все
   - 👤 Пользователь
   - ⚙️ Система

**Ожидаемый результат:**
- [ ] Вкладка "Все" показывает все 14 переменных
- [ ] Вкладка "👤 Пользователь" показывает 9 переменных (name, email, balance и т.д.)
- [ ] Вкладка "⚙️ Система" показывает 5 переменных (platformName, currentYear и т.д.)
- [ ] Активная вкладка подсвечена градиентом

---

### 8. **Анимации** 🎭

**Что проверить:**
- [ ] Блок "Используемые переменные" появляется с анимацией сверху вниз
- [ ] Подсказка в превью появляется с fade-in
- [ ] Карточки переменных имеют hover-эффект
- [ ] Dropdown открывается плавно

---

### 9. **Клик вне dropdown** 🖱️

**Шаги:**
1. Откройте dropdown переменных
2. Кликните мышью за пределами dropdown

**Ожидаемый результат:**
- [ ] Dropdown закрывается

---

### 10. **Сохранение рассылки** 💾

**Шаги:**
1. Заполните:
   - Название: `Тестовая рассылка с переменными`
   - Тема: `Привет, {{name}}!`
   - Текст: `Ваш баланс: {{balance}} монет`
2. Нажмите "💾 Сохранить черновик"

**Ожидаемый результат:**
- [ ] Рассылка сохранена
- [ ] Переменные сохранены в тексте как `{{name}}`, а не как примеры
- [ ] После сохранения можно вернуться к редактированию

---

## 🐛 Возможные проблемы

### Проблема: Dropdown не открывается

**Решение:**
- Проверьте консоль браузера (F12)
- Возможно нужно перезапустить frontend: `Ctrl+C` → `npm run dev`

### Проблема: Переменные не заменяются в превью

**Решение:**
- Убедитесь, что backend запущен на порту 8880
- Проверьте наличие переменных в базе: `node backend/check-email-variables.js`

### Проблема: Стили не применяются

**Решение:**
- Очистите кеш браузера (Ctrl+Shift+R)
- Проверьте, что файл `VariableInserter.css` загружен в DevTools → Sources

---

## 📸 Скриншоты (для проверки)

### Должно выглядеть так:

**1. Toolbar с кнопкой переменных:**
```
[{{}} Переменная] | [B] [I] [U] | [H1] [H2] [P] | ...
```

**2. Открытый dropdown:**
```
┌─────────────────────────────────────┐
│ 🔍 Поиск переменной...              │
├─────────────────────────────────────┤
│ [Все] [👤 Пользователь] [⚙️ Система] │
├─────────────────────────────────────┤
│ {{name}}                             │
│ Полное имя пользователя              │
│ Пример: Иван Иванов                  │
├─────────────────────────────────────┤
│ {{email}}                            │
│ Email адрес пользователя             │
│ ...                                  │
└─────────────────────────────────────┘
```

**3. Блок используемых переменных:**
```
┌────────────────────────────────────────────────┐
│ ℹ️ Используемые переменные:                    │
├────────────────────────────────────────────────┤
│ [{{name}} | Полное имя пользователя]          │
│ [{{email}} | Email адрес пользователя]        │
└────────────────────────────────────────────────┘
```

**4. Превью с подсказкой:**
```
┌────────────────────────────────────────┐
│ 👁️ Предварительный просмотр            │
│         [💡 Переменные заменены на примеры] │
├────────────────────────────────────────┤
│ Тема: Привет, Иван Иванов!            │
├────────────────────────────────────────┤
│ Привет, Иван Иванов!                   │
│                                        │
│ Ваш email: user@example.com           │
│ Баланс: 100 монет                      │
└────────────────────────────────────────┘
```

---

## ✅ Чек-лист после тестирования

Отметьте пункты, которые работают корректно:

- [ ] Кнопка переменных отображается
- [ ] Dropdown открывается/закрывается
- [ ] Поиск работает
- [ ] Вкладки категорий переключаются
- [ ] Переменная вставляется в текст
- [ ] Курсор устанавливается правильно
- [ ] Блок "Используемые переменные" появляется
- [ ] Превью заменяет переменные
- [ ] Подсказка в превью отображается
- [ ] Все анимации работают
- [ ] Hover-эффекты работают
- [ ] Рассылка сохраняется с переменными

---

## 📝 Отчет о тестировании

**Дата:** __________  
**Тестировщик:** __________  
**Браузер:** __________  
**Результат:** ☐ Все тесты пройдены | ☐ Есть проблемы

**Найденные проблемы:**
_________________________________________________
_________________________________________________
_________________________________________________

---

*Инструкция создана: 1 октября 2025*  
*Проект: Wekey Tools - Email Marketing System*
