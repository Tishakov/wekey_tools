<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∫–æ–∏–Ω–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 5px;
        }
        input {
            background: #3a3a3a;
            color: #fff;
        }
        button {
            background: #5E35F2;
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            background: #4a28d4;
        }
        .coin-balance {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #333;
            border-radius: 10px;
            margin: 10px 0;
        }
        .coin-icon {
            width: 24px;
            height: 24px;
        }
        .balance-amount {
            font-weight: bold;
            font-size: 18px;
        }
        #userInfo {
            display: none;
        }
        #loginForm {
            display: block;
        }
    </style>
</head>
<body>
    <h1>ü™ô –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∫–æ–∏–Ω–æ–≤ Wekey Tools</h1>
    
    <div id="loginForm" class="container">
        <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <div>
            <input type="email" id="email" placeholder="Email" value="test@example.com">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="12345678">
            <button onclick="login()">–í–æ–π—Ç–∏</button>
        </div>
    </div>
    
    <div id="userInfo" class="container">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
        <div id="userDetails"></div>
        
        <div class="coin-balance">
            <svg class="coin-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24Z" fill="#FFCE33"/>
                <path d="M12.0004 21.6005C17.2112 21.6005 21.4354 17.3763 21.4354 12.1655C21.4354 6.95466 17.2112 2.73047 12.0004 2.73047C6.78962 2.73047 2.56543 6.95466 2.56543 12.1655C2.56543 17.3763 6.78962 21.6005 12.0004 21.6005Z" fill="#F28A00"/>
            </svg>
            <span>–ë–∞–ª–∞–Ω—Å –∫–æ–∏–Ω–æ–≤:</span>
            <span id="coinBalance" class="balance-amount">0</span>
        </div>
        
        <button onclick="spendCoin()">–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å 1 –∫–æ–∏–Ω (—Ç–µ—Å—Ç)</button>
        <button onclick="refreshProfile()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        <button onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>

    <script>
        const API_BASE = 'http://localhost:8880/api';
        let currentToken = null;
        let currentUser = null;

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentToken = data.token;
                    currentUser = data.user;
                    showUserInfo();
                    await loadProfile();
                } else {
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function loadProfile() {
            if (!currentToken) return;
            
            try {
                const response = await fetch(`${API_BASE}/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    updateUserDisplay();
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è: ' + data.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function spendCoin() {
            if (!currentUser || currentUser.coinBalance <= 0) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤!');
                return;
            }
            
            try {
                // –°–∏–º—É–ª–∏—Ä—É–µ–º —Ç—Ä–∞—Ç—É –∫–æ–∏–Ω–∞ (—ç—Ç–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞ –±—ç–∫–µ–Ω–¥–µ)
                const response = await fetch(`${API_BASE}/coins/spend`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        toolName: 'test-tool',
                        amount: 1 
                    })
                });
                
                if (response.ok) {
                    await loadProfile(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç—Ä–∞—Ç–µ –∫–æ–∏–Ω–∞');
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function showUserInfo() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            updateUserDisplay();
        }

        function updateUserDisplay() {
            const userDetails = document.getElementById('userDetails');
            const coinBalance = document.getElementById('coinBalance');
            
            userDetails.innerHTML = `
                <p><strong>Email:</strong> ${currentUser.email}</p>
                <p><strong>–ò–º—è:</strong> ${currentUser.firstName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'} ${currentUser.lastName || ''}</p>
                <p><strong>–†–æ–ª—å:</strong> ${currentUser.role}</p>
            `;
            
            coinBalance.textContent = currentUser.coinBalance || 0;
        }

        function refreshProfile() {
            loadProfile();
        }

        function logout() {
            currentToken = null;
            currentUser = null;
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
        }
    </script>
</body>
</html>